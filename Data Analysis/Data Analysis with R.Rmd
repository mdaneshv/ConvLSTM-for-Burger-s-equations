---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}
library(ggplot2)
library(dplyr)
library(lubridate)
library(readr)
library(Hmisc)
library(janitor)
```

```{r}
dir_path <- 'Fitabase Data 4.12.16-5.12.16/'

# Load datasets
daily_data <- read_csv(paste0(dir_path,'dailyActivity_merged.csv'), show_col_types=FALSE)
sleep_data <- read_csv(paste0(dir_path,'sleepDay_merged.csv'), show_col_types=FALSE)
weight_data <- read_csv(paste0(dir_path,'weightLogInfo_merged.csv'), show_col_types=FALSE)
hr_data <- read_csv(paste0(dir_path,'heartrate_seconds_merged.csv'), show_col_types=FALSE)
```
```{r}
glimpse(daily_data)
```
```{r}

glimpse(sleep_data)

```

```{r}

glimpse(weight_data)

```
```{r}

glimpse(hr_data)
```
```{r}
# Clean column names
daily_data <- clean_names(daily_data)
sleep_data <- clean_names(sleep_data)
weight_data <- clean_names(weight_data)
hr_data <- clean_names(hr_data)
```
```{r}
# Change the character type to date or data/time data
daily_data$activity_date <- mdy(daily_data$activity_date)
sleep_data$sleep_day <- mdy_hms(sleep_data$sleep_day)
weight_data$date <- mdy_hms(weight_data$date)
hr_data$time <- mdy_hms(hr_data$time)
```

```{r}
# Check duplicated rows
sleep_data[duplicated(sleep_data),]
```

```{r}
# Remove duplicated rows
sleep_data <- sleep_data[!duplicated(sleep_data), ]
```

```{r}
# Look for missing values
cat('daily_data includes NA values:', any(is.na(daily_data)==TRUE), '\n')
cat('weight_data includes NA values:', any(is.na(weight_data)==TRUE), '\n')
cat('sleep_data includes NA values:', any(is.na(sleep_data)==TRUE), '\n')
cat('hr_data includes NA values:', any(is.na(hr_data)==TRUE))
```
```{r}
colSums(is.na(weight_data))/nrow(weight_data)
```
```{r}
# Remove the "fat" column from weight_data
weight_data <- weight_data %>% select(-fat)
```
```{r}
cat('number of users who shared their daily activity =', length(unique(daily_data$id)), '\n')
cat('number of users who shared their sleep activity =', length(unique(sleep_data$id)), '\n')
cat('number of users who shared their weight data =',length(unique(weight_data$id)), '\n')
cat('number of users who shared their heart rate data =',length(unique(hr_data$id)))
```
```{r}
# Create a function for plot size
plot_size <- function(width, height, ...){
    options(repr.plot.width = width, repr.plot.height = height)
    }

#  Customize hist() function to change colors
hist.data.frame <- function(x, ..., colors = rainbow(ncol(x))) {
  col <- 1
  hist <- function(...) {
    graphics::hist(..., col = colors[col])
    col <<- col + 1
  }
  f <- Hmisc:::hist.data.frame
  environment(f) <- environment()
  f(x, ...)
}
```
```{r}
plot_size(40,25)
hist(daily_data[,-c(1,2)], main=hi)
cat('Daily Activity Data:')
```

```{r}
plot_size(15,10)
hist(sleep_data[,-c(1,2)])
cat('Sleep Data:')
```
```{r}
plot_size(12,10)
hist(weight_data[,-c(1,2)])
cat('Weight Data:')
```
```{r}
plot_size(10,5)
hist(hr_data[,-c(1,2)])
cat('Heart Rate Data:')
```

```{r}
attach(daily_data)
attach(sleep_data)
attach(weight_data)
attach(hr_data)

plot_size(25,20)
par(mfrow=c(3,2))

qqnorm(total_distance, main='Q-Q plot for total_distance vs normal distribution')
qqline(total_distance, col=4)
#
qqnorm(calories, main='Q-Q plot for calories vs normal distribution')
qqline(calories, col=4)
#
qqnorm(total_minutes_asleep, main='Q-Q plot for total_minutes_asleep vs normal distribution')
qqline(total_minutes_asleep, col=4)
#
qqnorm(weight_kg, main='Q-Q plot for weight_kg vs normal distribution')
qqline(weight_kg, col=4)
#
avg_heart_rate <- hr_data %>%
group_by(id) %>%
summarise(avg=mean(value))
qqnorm(avg_heart_rate$avg, main='Q-Q plot for avg_heart_rate vs normal distribution')
qqline(avg_heart_rate$avg, col=4)
```
```{r}
# Calculate the best estimate for the population mean 
t.test(total_distance, mu=5, conf.level=.99)
t.test(calories, mu=2000, conf.level=.99)
t.test(total_minutes_asleep, mu=410, conf.level=.99)
t.test(weight_kg, alternative='greater', mu=70, conf.level=.99)
```
```{r}
# Inspect with visualization
plot_size(10,7)
ggplot(daily_data) + 
geom_point(aes(x=total_distance, y=tracker_distance)) + 
labs(x='Total Distance', y='Tracker Distance') +
ggtitle("Scatter plot: total_distance vs tracker_distance") +
theme_bw() +
theme(axis.title.x = element_text(size = 15, face = "bold", color='black', hjust = 0.5),
      axis.title.y = element_text(size = 15, face = "bold", color='black', hjust = 0.5),
      plot.title = element_text(size=20, face='bold', color='purple', hjust=0.5))
```

Possible explanation:

The total distance is the real distance and the tracker distance is the distance calculated by the smart tracker. It seems that the tracker, almost perfectly, calculates the total distance. In few cases, the tracker distance is less than the actual distance. One reason is the user was not wearing the tracker or the user's activity was not captured by the tracker for some reasons such as users location, etc. 

Push notifications and reminders might be helpful to remind users of wearing the tracker properly.

```{r}
df <- daily_data %>%
select(id, activity_date,total_distance) %>%
group_by(id) %>%
summarise(num_days=n_distinct(activity_date),
          average_distance=mean(total_distance))

head(df)
summary(df)
```

